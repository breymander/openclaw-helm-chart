# Default values for openclaw
# This is a YAML-formatted file.

# Image configuration
image:
  repository: ghcr.io/openclaw/openclaw
  tag: "latest"
  pullPolicy: IfNotPresent

# Image pull secrets (optional)
imagePullSecrets: []

# Service account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  runAsUser: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

# Replica count for StatefulSet
replicaCount: 1

# Per-replica configuration overrides
# When replicaCount > 1, you can configure different environment variables for each replica
# Replica indices are 0-based (0 = first replica, 1 = second replica, etc.)
# Each replica will have STATEFULSET_REPLICA_INDEX env var set to its index
# NOTE: Resources, nodeSelector, tolerations, and affinity cannot be different per replica
#       in a single StatefulSet. For those, use multiple StatefulSets or handle in application.
replicaOverrides: {}
  # Example: Configure different env vars for replica 0 (first replica)
  # "0":
  #   env:
  #     REPLICA_ROLE: "primary"
  #     REPLICA_PRIORITY: "high"
  # Example: Configure different env vars for replica 1 (second replica)
  # "1":
  #   env:
  #     REPLICA_ROLE: "secondary"
  #     CUSTOM_VAR: "replica-1-value"

# Service configuration
service:
  type: ClusterIP
  port: 18789
  targetPort: 18789
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: openclaw.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Persistent volume configuration
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

# Environment variables configuration
# SECURITY WARNING: Never put API keys, passwords, or other sensitive data in this file!
# Use Kubernetes Secrets instead. See README.md for secure configuration options.
env:
  # LLM/API Configuration
  # ANTHROPIC_API_KEY and OPENCLAW_GATEWAY_TOKEN should be provided via existingSecret (see below)
  # Model settings
  CLAUDE_MODEL: "claude-3-5-sonnet-20241022"
  # Service configuration
  PORT: "18789"
  HOST: "0.0.0.0"
  # Logging
  LOG_LEVEL: "info"
  # Storage/persistence
  DATA_DIR: "/data"
  # Memory/session persistence
  MEMORY_ENABLED: "true"
  # Integration settings (email, messaging platforms)
  # Add specific integration env vars as needed
  # Example: TELEGRAM_BOT_TOKEN: ""
  # Example: EMAIL_SMTP_HOST: ""
  # Example: EMAIL_SMTP_PORT: "587"
  
# Extra environment variables for future extensibility
extraEnv: []
  # Example:
  # - name: CUSTOM_VAR
  #   value: "custom-value"
  # - name: SECRET_VAR
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key

# Gateway Control UI settings
# allowInsecureAuth: when true, sets gateway.controlUi.allowInsecureAuth (token-in-URL auth for Control UI).
# With persistence enabled: init container merges this into /data/.openclaw/openclaw.json (creates if missing).
# With persistence disabled: ephemeral config is provided at ~/.openclaw/openclaw.json.
gateway:
  controlUi:
    allowInsecureAuth: true
  # Built-in OpenClaw channels (WhatsApp, Telegram, Discord, Slack, Google Chat, etc.).
  # Config is merged into ~/.openclaw/openclaw.json under gateway.channels.
  # Put tokens in existingSecret (e.g. TELEGRAM_BOT_TOKEN) and reference in channel config if the app supports env vars; see README.
  channels: {}
    # Example - Telegram (put TELEGRAM_BOT_TOKEN in existingSecret):
    # telegram:
    #   enabled: true
    #   allowFrom: ["123456789"]
    #   groups: {"*": { requireMention: true }}
    # Example - Discord (put token in existingSecret and reference via env or configure in Control UI):
    # discord:
    #   enabled: true
    #   dm: { enabled: true, allowFrom: ["your-username"] }
    #   guilds: {}
    # Example - WhatsApp (allowlist a number; pairing is done via Control UI):
    # whatsapp:
    #   allowFrom: ["+15555550123"]
    #   groups: {"*": { requireMention: true }}
  # Init container image; must have sh and jq (merge/create JSON). Default: pascaliske/alpine-curl-jq (jq pre-installed).
  initImage: "pascaliske/alpine-curl-jq"

# Environment variables from ConfigMap
envFromConfigMap: []
  # Example:
  # - configMapRef:
  #     name: my-configmap

# Environment variables from Secrets
envFromSecret: []
  # Example:
  # - secretRef:
  #     name: my-secret

# Existing Secret configuration (RECOMMENDED for production)
# Use this to reference a pre-created Kubernetes Secret instead of storing secrets in values.yaml
#
# Required for gateway auth: OPENCLAW_GATEWAY_TOKEN (used to authenticate to the gateway / Control UI).
# Generate a random token, e.g.: openssl rand -hex 32
#
# Step 1: Create the secret first:
#   kubectl create secret generic openclaw-secrets \
#     --from-literal=ANTHROPIC_API_KEY=your-api-key-here \
#     --from-literal=OPENCLAW_GATEWAY_TOKEN=$(openssl rand -hex 32)
#
# Step 2: Configure it below:
existingSecret:
  # Name of the pre-created Kubernetes Secret
  name: ""
  # Map of environment variable names to secret keys
  # Format: envVarName: secretKeyName
  # If the env var name matches the secret key name, you can use a simpler format (see examples)
  keys: {}
    # Example 1: Simple case (env var name = secret key name)
    # ANTHROPIC_API_KEY: ANTHROPIC_API_KEY
    # OPENCLAW_GATEWAY_TOKEN: OPENCLAW_GATEWAY_TOKEN  # gateway auth token (required)
    #
    # Example 2: Different env var name than secret key
    # API_KEY: ANTHROPIC_API_KEY  # env var will be API_KEY, loads from secret key ANTHROPIC_API_KEY
    #
    # Example 3: Multiple keys
    # ANTHROPIC_API_KEY: ANTHROPIC_API_KEY
    # OPENCLAW_GATEWAY_TOKEN: OPENCLAW_GATEWAY_TOKEN
    # TELEGRAM_BOT_TOKEN: TELEGRAM_BOT_TOKEN

# ConfigMap data (non-sensitive configuration)
configMap:
  enabled: true
  data: {}
    # Example:
    # config.yaml: |
    #   key: value

# Secret data (sensitive configuration)
# WARNING: Only use this for development/testing. For production, use existingSecret instead.
# If you must use this, provide base64-encoded values:
#   echo -n "your-api-key" | base64
secret:
  enabled: false  # Disabled by default - use existingSecret for production
  data: {}
    # Example (NOT RECOMMENDED for production):
    # ANTHROPIC_API_KEY: <base64-encoded-value>

# Extra volumes
extraVolumes: []
  # Example:
  # - name: extra-storage
  #   persistentVolumeClaim:
  #     claimName: my-pvc

# Extra volume mounts
extraVolumeMounts: []
  # Example:
  # - name: extra-storage
  #   mountPath: /extra

# Container command (overrides image CMD). Default runs the gateway server.
# The image runs a CLI; without this, it would show help and exit.
# --allow-unconfigured lets the gateway start without running 'openclaw setup' first
# (config can be provided via env/secrets or onboarding done separately).
# --bind: use "lan" so the gateway is reachable in-cluster (valid: loopback, lan, tailnet, auto, custom).
command:
  - "node"
  - "dist/index.js"
  - "gateway"
  - "--bind"
  - "lan"
  - "--port"
  - "18789"
  - "--allow-unconfigured"

# Extra command arguments (appended after the command above)
extraArgs: []
  # Example:
  # - --custom-flag
  # - --another-flag=value

# Resource limits and requests
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# Liveness probe
# Using TCP socket check since OpenClaw doesn't expose HTTP health endpoints
livenessProbe:
  enabled: true
  tcpSocket:
    port: 18789
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe
# Using TCP socket check since OpenClaw doesn't expose HTTP health endpoints
readinessProbe:
  enabled: true
  tcpSocket:
    port: 18789
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# RBAC configuration
rbac:
  create: true
  rules: []
    # Example:
    # - apiGroups: [""]
    #   resources: ["pods"]
    #   verbs: ["get", "list"]

# Network policy
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  
  # Ingress rules - who can connect to OpenClaw
  ingress: []
    # Example: Allow traffic from same namespace (use allowSameNamespace: true instead)
    # - from:
    #     - namespaceSelector:
    #         matchLabels:
    #           name: my-namespace
    #   ports:
    #     - protocol: TCP
    #       port: 18789
  
  # Egress rules - where OpenClaw can connect to
  egress: []
    # Example: Allow DNS resolution
    # - to:
    #     - namespaceSelector:
    #         matchLabels:
    #           name: kube-system
    #   ports:
    #     - protocol: UDP
    #       port: 53
    #     - protocol: TCP
    #       port: 53
  
  # Common egress rules (can be enabled individually)
  allowDNS: true  # Allow DNS resolution (UDP/TCP port 53)
  allowSameNamespace: false  # Allow traffic to/from same namespace
  allowKubeSystem: false  # Allow traffic to kube-system namespace (for metrics, etc.)
  
  # Additional allowed namespaces (by label selector)
  allowedNamespaces: []
    # Example:
    # - matchLabels:
    #     name: monitoring
  
  # Additional allowed pods (by label selector)
  allowedPods: []
    # Example:
    # - namespaceSelector:
    #     matchLabels:
    #       name: monitoring
    #   podSelector:
    #     matchLabels:
    #       app: prometheus
  
  # Custom egress ports (in addition to DNS if allowDNS is true)
  customEgressPorts: []
    # Example:
    # - protocol: TCP
    #   port: 443  # HTTPS
    # - protocol: TCP
    #   port: 80   # HTTP

# StatefulSet update strategy
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    partition: 0

# Pod management policy
podManagementPolicy: OrderedReady
